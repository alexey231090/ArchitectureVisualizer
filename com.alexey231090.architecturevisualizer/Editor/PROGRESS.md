# Прогресс разработки

## Версия 0.2.0

### Описание
Плагин для анализа и визуализации архитектуры Unity-проекта.

### Текущий прогресс
- [x] Базовая структура плагина
- [x] Интеграция с Unity Editor
- [x] Анализ зависимостей между скриптами
- [x] Отображение структуры проекта
- [x] Детальный анализ полей скриптов
- [x] Отображение текущих значений полей
- [x] Поддержка вложенных типов
- [x] Отображение значений массивов и коллекций
- [ ] Анализ использования компонентов
- [ ] Экспорт данных в различные форматы

### Event Tracking (актуализация)

#### Что мы восстанавливаем
- Полноценный Event Tracking:
  - UI для добавления, редактирования, удаления путей (цепочек) и шагов
  - Выбор скрипта и переменной для каждого шага
  - Многострочные комментарии
  - Английский интерфейс
  - Поддержка кириллицы (теперь работает без костылей)
  - Поддержка массивов и коллекций
  - Отображение значений для всех экземпляров объектов
  - Подсветка изменений (fade/highlight)
  - Реальное время обновления значений
  - Удобный редактор цепочек и шагов
  - Устойчивость к ошибкам (NullReference и др.)
  - Интеграция с EventTrackingManager

#### Что уже реализовано в новой версии
- Окно Add Path: выбор скрипта, переменной, имя пути, комментарий (всё на английском)
- Окно Add Step: выбор скрипта, переменной, комментарий
- Окно Edit Path: редактирование имени, описания, шагов, комментариев
- Все кнопки и UI на английском
- Многострочные поля для комментариев и описаний
- Поддержка кириллицы в стандартных полях (без кнопки "Рус")

#### Что ещё нужно сделать
- Реальное время обновления значений переменных при активном трекинге
- Подсветка изменений (fade/highlight) для изменённых экземпляров
- Поддержка массивов и коллекций в шагах
- Отображение значений для всех экземпляров объектов (например, все зомби)
- Интеграция с EventTrackingManager для хранения и управления всеми путями/шагами
- Тестирование и устранение багов

#### Что было в старой версии Event Tracking
- UI с вкладкой Event Tracking, поддержкой кириллицы (через кнопку "Рус")
- Добавление/редактирование путей и шагов, многострочные комментарии
- Поддержка массивов, коллекций, множественных экземпляров
- Подсветка изменений значений (fade/highlight)
- Реальное время обновления при активном трекинге
- Устойчивость к ошибкам (NullReference и др.)
- Удобный редактор цепочек и шагов

### Статус
- Восстановление Event Tracking в процессе. Основной UI и базовые функции уже работают. Впереди — восстановление реального времени, подсветки, поддержки коллекций и тестирование.

### Известные проблемы
1. Некоторые типы полей могут не отображаться корректно
2. При большом количестве скриптов может быть медленная загрузка
3. Не все типы компонентов поддерживаются
4. Проблема с кириллицей в EditorWindow

### Следующие шаги
1. Улучшение производительности при анализе больших проектов
2. Добавление поддержки большего количества типов компонентов
3. Реализация экспорта данных
4. Улучшение UI/UX

### Решенные проблемы

#### Проблема с подсветкой изменений в Event Tracking
- **Симптом:** При активном отслеживании переменной в режиме Play, её значение в UI обновлялось, но подсветка (изменение цвета на жёлтый) не срабатывала.
- **Причина:** Корень проблемы лежал в обработке жизненного цикла объектов Unity при переходе из режима редактора в режим Play. В режиме Play Unity создает **копии** отслеживаемых объектов, у которых другие `InstanceID`. Плагин обнаруживал исчезновение старого объекта (из редактора) и появление нового (из игры), но из-за ошибки в логике обновления он не мог корректно сохранить состояние этого нового объекта между циклами проверки. Каждый раз он находил игровой объект "как в первый раз", и сравнение `старое_значение != новое_значение` никогда не срабатывало, так как не было сохраненного "старого" значения для сравнения.
- **Решение:** Логика обновления данных (`UpdateTrackedValuesData`) была переписана. Теперь она сначала получает полный список `InstanceID` всех активных на сцене объектов нужного типа. Затем этот список используется для корректного удаления неактуальных отслеживаемых экземпляров из памяти. Это гарантирует, что состояние актуальных, игровых объектов сохраняется между циклами обновления, позволяя правильно обнаруживать изменения и активировать подсветку.

### Технические детали

#### Структура проекта
```
Assets/
└── Editor/
    ├── ArchitectureVisualizer/
    │   ├── Core/           # Основные компоненты
    │   ├── Modules/        # Модули плагина
    │   └── Resources/      # Ресурсы модулей
    ├── Resources/          # Общие ресурсы
    ├── Plugins/           # Внешние плагины
    ├── Packages/          # Зависимости
    ├── README.md          # Документация
    ├── TECHNICAL.md       # Техническая документация
    ├── PROGRESS.md        # Отслеживание прогресса
    ├── .gitignore
    └── package.json
```

#### Ключевые компоненты
1. ArchitectureVisualizerWindow - главное окно плагина
2. ScriptAnalyzer - анализ скриптов и их зависимостей
3. ProjectStructureView - отображение структуры проекта
4. ScriptDetailsView - детальный анализ скриптов

#### Зависимости
- Unity 2020.3 или выше
- .NET 4.7.1 или выше

### Примечания
- Улучшена производительность анализа скриптов
- Добавлено отображение текущих значений полей
- Улучшен UI для более удобного использования
- Добавлена поддержка анализа компонентов
- Добавлена поддержка вложенных типов
- Улучшено отображение значений массивов и коллекций
- Исправлены проблемы с отображением типов полей

### Текущие задачи
1. Оптимизация производительности
2. Улучшение поддержки различных типов компонентов
3. Добавление новых функций анализа
4. Улучшение документации

## Проблема с кириллицей в EditorWindow

**Описание:**
В EditorWindow (UIElements) плагина при вводе текста по-русски в поля TextField (например, комментарии) на Windows появляются некорректные символы. При этом отображение кириллицы в Label с тем же шрифтом (Roboto) работает корректно, а также работает копипаст русского текста в поле.

**Причина:**
Это известный баг Unity Editor (особенно на Windows), связанный с обработкой ввода в UIElements/TextField. Проблема не в шрифте и не в кодировке, а в самом механизме ввода.

**Возможные решения/обходы:**
- Использовать копипаст: писать комментарии в стороннем редакторе и вставлять в поле.
- Использовать EditorUtility.DisplayDialog для ввода текста (там обычно работает любой язык).
- Проверить совпадение языка системы и Unity.
- Обновить Unity до последней LTS-версии (2021.3+, 2022+).
- Сообщить о баге в Unity через Report a Bug.

**Статус:**
Проблема воспроизводится, workaround — копипаст или отдельное окно для ввода комментария.

**Новое решение (реализовано в плагине):**
В окнах ввода комментариев и описаний добавлена кнопка "Рус". При её активации можно печатать на английской раскладке, а текст автоматически преобразуется в русские буквы (транслитерация по раскладке). Это полностью устраняет баг Unity с кириллицей в TextField — не требуется переключать системную раскладку Windows. 